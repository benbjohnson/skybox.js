(function(){function require(path,parent,orig){var resolved=require.resolve(path);if(null==resolved){orig=orig||path;parent=parent||"root";var err=new Error('Failed to require "'+orig+'" from "'+parent+'"');err.path=orig;err.parent=parent;err.require=true;throw err}var module=require.modules[resolved];if(!module.exports){module.exports={};module.client=module.component=true;module.call(this,module.exports,require.relative(resolved),module)}return module.exports}require.modules={};require.aliases={};require.resolve=function(path){if(path.charAt(0)==="/")path=path.slice(1);var paths=[path,path+".js",path+".json",path+"/index.js",path+"/index.json"];for(var i=0;i<paths.length;i++){var path=paths[i];if(require.modules.hasOwnProperty(path))return path;if(require.aliases.hasOwnProperty(path))return require.aliases[path]}};require.normalize=function(curr,path){var segs=[];if("."!=path.charAt(0))return path;curr=curr.split("/");path=path.split("/");for(var i=0;i<path.length;++i){if(".."==path[i]){curr.pop()}else if("."!=path[i]&&""!=path[i]){segs.push(path[i])}}return curr.concat(segs).join("/")};require.register=function(path,definition){require.modules[path]=definition};require.alias=function(from,to){if(!require.modules.hasOwnProperty(from)){throw new Error('Failed to alias "'+from+'", it does not exist')}require.aliases[to]=from};require.relative=function(parent){var p=require.normalize(parent,"..");function lastIndexOf(arr,obj){var i=arr.length;while(i--){if(arr[i]===obj)return i}return-1}function localRequire(path){var resolved=localRequire.resolve(path);return require(resolved,parent,path)}localRequire.resolve=function(path){var c=path.charAt(0);if("/"==c)return path.slice(1);if("."==c)return require.normalize(p,path);var segs=parent.split("/");var i=lastIndexOf(segs,"deps")+1;if(!i)i=0;path=segs.slice(0,i+1).join("/")+"/deps/"+path;return path};localRequire.exists=function(path){return require.modules.hasOwnProperty(localRequire.resolve(path))};return localRequire};require.register("avetisk-defaults/index.js",function(exports,require,module){"use strict";var defaults=function(dest,src,recursive){for(var prop in src){if(recursive&&dest[prop]instanceof Object&&src[prop]instanceof Object){dest[prop]=defaults(dest[prop],src[prop],true)}else if(!(prop in dest)){dest[prop]=src[prop]}}return dest};module.exports=defaults});require.register("component-bind/index.js",function(exports,require,module){var slice=[].slice;module.exports=function(obj,fn){if("string"==typeof fn)fn=obj[fn];if("function"!=typeof fn)throw new Error("bind() requires a function");var args=[].slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}});require.register("component-clone/index.js",function(exports,require,module){var type;try{type=require("type")}catch(e){type=require("type-component")}module.exports=clone;function clone(obj){switch(type(obj)){case"object":var copy={};for(var key in obj){if(obj.hasOwnProperty(key)){copy[key]=clone(obj[key])}}return copy;case"array":var copy=new Array(obj.length);for(var i=0,l=obj.length;i<l;i++){copy[i]=clone(obj[i])}return copy;case"regexp":var flags="";flags+=obj.multiline?"m":"";flags+=obj.global?"g":"";flags+=obj.ignoreCase?"i":"";return new RegExp(obj.source,flags);case"date":return new Date(obj.getTime());default:return obj}}});require.register("component-cookie/index.js",function(exports,require,module){var encode=encodeURIComponent;var decode=decodeURIComponent;module.exports=function(name,value,options){switch(arguments.length){case 3:case 2:return set(name,value,options);case 1:return get(name);default:return all()}};function set(name,value,options){options=options||{};var str=encode(name)+"="+encode(value);if(null==value)options.maxage=-1;if(options.maxage){options.expires=new Date(+new Date+options.maxage)}if(options.path)str+="; path="+options.path;if(options.domain)str+="; domain="+options.domain;if(options.expires)str+="; expires="+options.expires.toGMTString();if(options.secure)str+="; secure";document.cookie=str}function all(){return parse(document.cookie)}function get(name){return all()[name]}function parse(str){var obj={};var pairs=str.split(/ *; */);var pair;if(""==pairs[0])return obj;for(var i=0;i<pairs.length;++i){pair=pairs[i].split("=");obj[decode(pair[0])]=decode(pair[1])}return obj}});require.register("component-props/index.js",function(exports,require,module){var globals=/\b(Array|Date|Object|Math|JSON)\b/g;module.exports=function(str,fn){var p=unique(props(str));if(fn&&"string"==typeof fn)fn=prefixed(fn);if(fn)return map(str,p,fn);return p};function props(str){return str.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\//g,"").replace(globals,"").match(/[a-zA-Z_]\w*/g)||[]}function map(str,props,fn){var re=/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\/|[a-zA-Z_]\w*/g;return str.replace(re,function(_){if("("==_[_.length-1])return fn(_);if(!~props.indexOf(_))return _;return fn(_)})}function unique(arr){var ret=[];for(var i=0;i<arr.length;i++){if(~ret.indexOf(arr[i]))continue;ret.push(arr[i])}return ret}function prefixed(str){return function(_){return str+_}}});require.register("component-to-function/index.js",function(exports,require,module){var expr=require("props");module.exports=toFunction;function toFunction(obj){switch({}.toString.call(obj)){case"[object Object]":return objectToFunction(obj);case"[object Function]":return obj;case"[object String]":return stringToFunction(obj);case"[object RegExp]":return regexpToFunction(obj);default:return defaultToFunction(obj)}}function defaultToFunction(val){return function(obj){return val===obj}}function regexpToFunction(re){return function(obj){return re.test(obj)}}function stringToFunction(str){if(/^ *\W+/.test(str))return new Function("_","return _ "+str);return new Function("_","return "+get(str))}function objectToFunction(obj){var match={};for(var key in obj){match[key]=typeof obj[key]==="string"?defaultToFunction(obj[key]):toFunction(obj[key])}return function(val){if(typeof val!=="object")return false;for(var key in match){if(!(key in val))return false;if(!match[key](val[key]))return false}return true}}function get(str){var props=expr(str);if(!props.length)return"_."+str;var val;for(var i=0,prop;prop=props[i];i++){val="_."+prop;val="('function' == typeof "+val+" ? "+val+"() : "+val+")";str=str.replace(new RegExp(prop,"g"),val)}return str}});require.register("component-each/index.js",function(exports,require,module){var toFunction=require("to-function");var type;try{type=require("type-component")}catch(e){type=require("type")}var has=Object.prototype.hasOwnProperty;module.exports=function(obj,fn){fn=toFunction(fn);switch(type(obj)){case"array":return array(obj,fn);case"object":if("number"==typeof obj.length)return array(obj,fn);return object(obj,fn);case"string":return string(obj,fn)}};function string(obj,fn){for(var i=0;i<obj.length;++i){fn(obj.charAt(i),i)}}function object(obj,fn){for(var key in obj){if(has.call(obj,key)){fn(key,obj[key])}}}function array(obj,fn){for(var i=0;i<obj.length;++i){fn(obj[i],i)}}});require.register("component-trim/index.js",function(exports,require,module){exports=module.exports=trim;function trim(str){if(str.trim)return str.trim();return str.replace(/^\s*|\s*$/g,"")}exports.left=function(str){if(str.trimLeft)return str.trimLeft();return str.replace(/^\s*/,"")};exports.right=function(str){if(str.trimRight)return str.trimRight();return str.replace(/\s*$/,"")}});require.register("component-querystring/index.js",function(exports,require,module){var trim=require("trim");exports.parse=function(str){if("string"!=typeof str)return{};str=trim(str);if(""==str)return{};var obj={};var pairs=str.split("&");for(var i=0;i<pairs.length;i++){var parts=pairs[i].split("=");obj[parts[0]]=null==parts[1]?"":decodeURIComponent(parts[1])}return obj};exports.stringify=function(obj){if(!obj)return"";var pairs=[];for(var key in obj){pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(obj[key]))}return pairs.join("&")}});require.register("component-type/index.js",function(exports,require,module){var toString=Object.prototype.toString;module.exports=function(val){switch(toString.call(val)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}if(val===null)return"null";if(val===undefined)return"undefined";if(val&&val.nodeType===1)return"element";if(val===Object(val))return"object";return typeof val}});require.register("ianstormtaylor-is-empty/index.js",function(exports,require,module){module.exports=isEmpty;var has=Object.prototype.hasOwnProperty;function isEmpty(val){if(null==val)return true;if("number"==typeof val)return 0===val;if(undefined!==val.length)return 0===val.length;for(var key in val)if(has.call(val,key))return false;return true}});require.register("segmentio-extend/index.js",function(exports,require,module){module.exports=function extend(object){var args=Array.prototype.slice.call(arguments,1);for(var i=0,source;source=args[i];i++){if(!source)continue;for(var property in source){object[property]=source[property]}}return object}});require.register("component-url/index.js",function(exports,require,module){exports.parse=function(url){var a=document.createElement("a");a.href=url;return{href:a.href,host:a.host||location.host,port:"0"===a.port||""===a.port?port(a.protocol):a.port,hash:a.hash,hostname:a.hostname||location.hostname,pathname:a.pathname.charAt(0)!="/"?"/"+a.pathname:a.pathname,protocol:!a.protocol||":"==a.protocol?location.protocol:a.protocol,search:a.search,query:a.search.slice(1)}};exports.isAbsolute=function(url){return 0==url.indexOf("//")||!!~url.indexOf("://")};exports.isRelative=function(url){return!exports.isAbsolute(url)};exports.isCrossDomain=function(url){url=exports.parse(url);return url.hostname!==location.hostname||url.port!==location.port||url.protocol!==location.protocol};function port(protocol){switch(protocol){case"http:":return 80;case"https:":return 443;default:return location.port}}});require.register("segmentio-top-domain/index.js",function(exports,require,module){var url=require("url");module.exports=function(urlStr){var host=url.parse(urlStr).hostname,topLevel=host.match(/[a-z0-9][a-z0-9\-]*[a-z0-9]\.[a-z\.]{2,6}$/i);return topLevel?topLevel[0]:host}});require.register("timoxley-next-tick/index.js",function(exports,require,module){"use strict";if(typeof setImmediate=="function"){module.exports=function(f){setImmediate(f)}}else if(typeof process!="undefined"&&typeof process.nextTick=="function"){module.exports=process.nextTick}else if(typeof window=="undefined"||window.ActiveXObject||!window.postMessage){module.exports=function(f){setTimeout(f)}}else{var q=[];window.addEventListener("message",function(){var i=0;while(i<q.length){try{q[i++]()}catch(e){q=q.slice(i);window.postMessage("tic!","*");throw e}}q.length=0},true);module.exports=function(fn){if(!q.length)window.postMessage("tic!","*");q.push(fn)}}});require.register("skybox/lib/index.js",function(exports,require,module){"use strict";var Skybox=require("./skybox"),bind=require("bind");module.exports=new Skybox;bind(module.exports,module.exports.init);bind(module.exports,module.exports.initialize)});require.register("skybox/lib/skybox.js",function(exports,require,module){"use strict";var Cookie=require("./cookie"),Device=require("./device"),User=require("./user"),each=require("each"),extend=require("extend"),isEmpty=require("is-empty"),querystring=require("querystring"),type=require("type");function Skybox(){this.apiKey=null;this.host=null;this.port=80;this.cookie=new Cookie;this.device=new Device;this.user=new User;this.initialized=false;this.resource(function(){return this.path().replace(/\/\d+(?=\/|\b)/g,"/:id")})}Skybox.prototype.initialize=function(apiKey,options){var self=this;this.apiKey=apiKey;this.options(options);this.initialized=true};Skybox.prototype.init=Skybox.prototype.inititialize;Skybox.prototype.options=function(value){if(arguments.length===0){return this._options}var options=value||{};this._options=options;this.cookie.options(options.cookie);this.device.options(options.device);this.user.options(options.user)};Skybox.prototype.identify=function(id){this.user.identify(id);return this};Skybox.prototype.track=function(action){var url,q,el,self=this,attr=this._options.mode==="test"?"title":"src",event={channel:"web",resource:this.resource(),action:action,domain:this.domain(),path:this.path()};if(!this.initialized){this.log("tracking not allowed before initialization");return this}q=extend(event,{apiKey:this.apiKey,user:this.user.serialize(),device:this.device.serialize()});url=this.url("/track.png",q);el=document.createElement("img");el.width=el.height=1;el[attr]=url;document.body.appendChild(el);setTimeout(function(){try{document.body.removeChild(el)}catch(e){}},100);return this};Skybox.prototype.page=function(name){return this.track("view")};Skybox.prototype.resource=function(value){if(arguments.length===0){return this._resource()}var v=typeof value==="function"?value:function(){return value};this._resource=v};Skybox.prototype.domain=function(){return window.location.host.replace(/:80$/,"")};Skybox.prototype.path=function(){return window.location.pathname.replace(/\/+$/,"")};Skybox.prototype.url=function(path,q){var i,key,params={},str="";str+="https:"===document.location.protocol?"https://":"http://";str+=isEmpty(this.host)?"localhost":this.host;str+=isEmpty(this.port)||this.port===80?"":":"+this.port;str+=path;if(type(q)==="object"){for(key in q){if(q.hasOwnProperty(key)){if(type(q[key])==="object"){for(i in q[key]){if(q[key].hasOwnProperty(i)){params[key+"."+i]=q[key][i]}}}else{params[key]=q[key]}}}}if(!isEmpty(params)){str+="?"+querystring.stringify(params)}return str};Skybox.prototype.log=function(msg){if(window.console){window.console.log("[skybox.js]: "+msg)}};module.exports=Skybox;Skybox.VERSION=Skybox.prototype.VERSION="0.1.0"});require.register("skybox/lib/device.js",function(exports,require,module){"use strict";var Cookie=require("./cookie"),defaults=require("defaults");function Device(options){this.cookie=new Cookie;this.options(options);this.initialize()}Device.prototype.initialize=function(){if(this.id()===null){var id="xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16)});this.cookie.set(this._options.cookie.key,id)}};Device.prototype.options=function(value){if(arguments.length===0){return this._options}var options=value||{};defaults(options,{cookie:{key:"trackjs_DeviceID"}});this._options=options};Device.prototype.id=function(id){if(this._options.mode==="test"){return"x"}return this.cookie.get(this._options.cookie.key)};Device.prototype.serialize=function(){return{id:this.id()}};module.exports=Device});require.register("skybox/lib/cookie.js",function(exports,require,module){"use strict";var bind=require("bind"),cookie=require("cookie"),clone=require("clone"),defaults=require("defaults"),topDomain=require("top-domain");function Cookie(options){this.options(options)}Cookie.prototype.options=function(value){if(arguments.length===0){return this._options}var options=value||{},domain="."+topDomain(window.location.href);if(domain===".localhost"){domain=""}defaults(options,{maxage:31536e6,path:"/",domain:domain});this._options=options};Cookie.prototype.set=function(key,value){try{value=JSON.stringify(value);cookie(key,value,clone(this._options));return true}catch(e){return false}};Cookie.prototype.get=function(key){try{var value=cookie(key);value=value?JSON.parse(value):null;return value}catch(e){return null}};Cookie.prototype.remove=function(key){try{cookie(key,null,clone(this._options));return true}catch(e){return false}};module.exports=Cookie});require.register("skybox/lib/user.js",function(exports,require,module){"use strict";var clone=require("clone"),Cookie=require("./cookie"),clone=require("clone"),defaults=require("defaults"),extend=require("extend"),isEmpty=require("is-empty");function User(options){this.cookie=new Cookie;this.options(options);this.id(null)}User.prototype.options=function(value){if(arguments.length===0){return this._options}var options=value||{};defaults(options,{cookie:{key:"trackjs_UserID"}});this._options=options};User.prototype.id=function(id){if(arguments.length===0){return this.cookie.get(this._options.cookie.key)}this.cookie.set(this._options.cookie.key,id)};User.prototype.identify=function(id){this.id(id)};User.prototype.logout=function(){this.id(null);this.cookie.remove(this._options.cookie.key)};User.prototype.serialize=function(){var obj={};if(this.id()){obj.id=this.id()}return obj};module.exports=User});require.alias("avetisk-defaults/index.js","skybox/deps/defaults/index.js");require.alias("avetisk-defaults/index.js","defaults/index.js");require.alias("component-bind/index.js","skybox/deps/bind/index.js");require.alias("component-bind/index.js","bind/index.js");require.alias("component-clone/index.js","skybox/deps/clone/index.js");require.alias("component-clone/index.js","clone/index.js");require.alias("component-type/index.js","component-clone/deps/type/index.js");require.alias("component-cookie/index.js","skybox/deps/cookie/index.js");require.alias("component-cookie/index.js","cookie/index.js");require.alias("component-each/index.js","skybox/deps/each/index.js");require.alias("component-each/index.js","each/index.js");require.alias("component-to-function/index.js","component-each/deps/to-function/index.js");require.alias("component-props/index.js","component-to-function/deps/props/index.js");require.alias("component-type/index.js","component-each/deps/type/index.js");require.alias("component-querystring/index.js","skybox/deps/querystring/index.js");require.alias("component-querystring/index.js","querystring/index.js");require.alias("component-trim/index.js","component-querystring/deps/trim/index.js");require.alias("component-type/index.js","skybox/deps/type/index.js");require.alias("component-type/index.js","type/index.js");require.alias("ianstormtaylor-is-empty/index.js","skybox/deps/is-empty/index.js");require.alias("ianstormtaylor-is-empty/index.js","is-empty/index.js");require.alias("segmentio-extend/index.js","skybox/deps/extend/index.js");require.alias("segmentio-extend/index.js","extend/index.js");require.alias("segmentio-top-domain/index.js","skybox/deps/top-domain/index.js");require.alias("segmentio-top-domain/index.js","skybox/deps/top-domain/index.js");require.alias("segmentio-top-domain/index.js","top-domain/index.js");require.alias("component-url/index.js","segmentio-top-domain/deps/url/index.js");require.alias("segmentio-top-domain/index.js","segmentio-top-domain/index.js");require.alias("timoxley-next-tick/index.js","skybox/deps/next-tick/index.js");require.alias("timoxley-next-tick/index.js","next-tick/index.js");require.alias("skybox/lib/index.js","skybox/index.js");if(typeof exports=="object"){module.exports=require("skybox")}else if(typeof define=="function"&&define.amd){define(function(){return require("skybox")})}else{this["skybox"]=require("skybox")}})();